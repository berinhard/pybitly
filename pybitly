#!/usr/bin/env python

import sys
from bitly_api import API


def bitly_shorten(long_url):
    api = API()
    response = api.shorten(long_url[0])
    if 'error_message' in response:
        print response['error_message']
    else:
        print response['url']

def bitly_expand(short_urls):
    api = API()
    response = api.expand(short_urls)
    if 'error_message' in response:
        print response['error_message']
    else:
        for url in response:
            print url['short_url'] + ' corresponds to ' + url['long_url']

def wrong_usage_warning(error_message = ''):
    print "pybitly: %s See 'pybitly --help'" % error_message
    sys.exit(1)

if len(sys.argv) < 3:
    wrong_usage_warning('no command specified.')
    sys.exit(1)

commands_dict = {
    '--shorten':bitly_shorten,
    '--expand':bitly_expand,
}
command = sys.argv[1]

if command in commands_dict:
    commands_dict[command](sys.argv[2:])
else:
    wrong_usage_warning('%s is not a pybitly command.' % command)
