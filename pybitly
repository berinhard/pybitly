#!/usr/bin/env python

import sys
from bitly_api import API


def bitly_shorten(long_url):
    api = API()
    response = api.shorten(long_url)
    if 'error_message' in response:
        return True, response['error_message']
    else:
        return False, response['url']

def bitly_expand(short_urls):
    api = API()
    response = api.expand(short_urls)
    if 'error_message' in response:
        return True, response['error_message']
    else:
        return False, response['expand']

def usage():
    print "pybitly: %s is not a pybitly command. See 'pybitly --help'" % sys.argv[1]
    sys.exit(1)

if len(sys.argv) < 2:
    print "pybitly: no parameter specified. See 'pybitly --help'"
    sys.exit(1)

operation = sys.argv[1]

if operation == '--shorten':
    #the operation accepts only one URL
    error, message = bitly_shorten(sys.argv[2])
    if error:
        print message
        usage()
    print message

elif operation == '--expand':
    #the operation accepts more than one url
    error, response = bitly_expand(sys.argv[2:])
    if error:
        print response
        usage()
    for i in response:
        print i['short_url'] + ' corresponds to ' + i['long_url']

else:
    usage()
